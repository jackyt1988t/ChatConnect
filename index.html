<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Websocket by jackyt1988t</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Websocket</h1>
      <h2 class="project-tagline">WebSocket</h2>
      <a href="https://github.com/jackyt1988t/WebSocket" class="btn">View on GitHub</a>
      <a href="https://github.com/jackyt1988t/WebSocket/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/jackyt1988t/WebSocket/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="mywebsocket" class="anchor" href="#mywebsocket" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>MyWebSocket</h1>

<h2>
<a id="websocket-server-написанный-на-языке-c" class="anchor" href="#websocket-server-%D0%BD%D0%B0%D0%BF%D0%B8%D1%81%D0%B0%D0%BD%D0%BD%D1%8B%D0%B9-%D0%BD%D0%B0-%D1%8F%D0%B7%D1%8B%D0%BA%D0%B5-c" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>WebSocket Server написанный на языке c#.</h2>

<p>Поддержка .NET Framework 4.5, Mono 4.2 <br></p>

<p>Пример простейшего WebSocket echo сервера <br> 
Данный пример показывает как запустить  WebSocket Сервер и зарегистрировать обработчики событий</p>

<div class="highlight highlight-source-cs"><pre><span class="pl-k">using</span> System<span class="pl-k">;</span>
<span class="pl-k">using</span> System.Text<span class="pl-k">;</span>

<span class="pl-k">using</span> ChatConnect.Tcp<span class="pl-k">;</span>
<span class="pl-k">using</span> ChatConnect.Tcp.Protocol<span class="pl-k">;</span>
<span class="pl-k">using</span> ChatConnect.Tcp.Protocol.WS<span class="pl-k">;</span>

<span class="pl-c">// Включить вывод отладочной информации</span>
WS.Debug = <span class="pl-c1">true</span>; 
WS.EventConnect += (<span class="pl-k">object</span> obj, PEventArgs a) =&gt;
{
    <span class="pl-c">// Объект WebSocket</span>
    WS WebSocket = obj <span class="pl-k">as</span> WS;
    <span class="pl-c">// Событие наступает когда приходят новые данные</span>
    WebSocket.EventData += (<span class="pl-k">object</span> sender, PEventArgs e) =&gt;
    {
        WSData data = e.sender <span class="pl-k">as</span> WSData;
        <span class="pl-k">if</span> (data.Opcod != WSOpcod.Text)
        {
            <span class="pl-k">byte</span>[] raw = data.ToByte(); 
        }
        <span class="pl-k">else</span>
        {
            Console.WriteLine(data.ToString());
            <span class="pl-c">// Отправляем текстовый фрейм</span>
            WebSocket.Message(data.ToString());
        }
    };
    <span class="pl-c">// Событие наступает если произошла ошибка данных</span>
    WebSocket.EventError += (<span class="pl-k">object</span> sender, PEventArgs e) =&gt;
    {
        Console.WriteLine(e.sender.ToString());
    };
    <span class="pl-c">// Событие наступает если соединение было закрыто</span>
    WebSocket.EventClose += (<span class="pl-k">object</span> sender, PEventArgs e) =&gt;
    {
        Console.WriteLine(e.sender.ToString());
    };
};
<span class="pl-c">// Запуск серверами с указанным адресом и номером порта с 2 потоками обработки подключений</span>
WServer Server = <span class="pl-k">new</span> WServer(<span class="pl-s"><span class="pl-pds">"</span>0.0.0.0<span class="pl-pds">"</span></span>, <span class="pl-c1">8081</span>, <span class="pl-c1">2</span>);</pre></div>

<div>Отладочная информация</div>

<p><img src="MyWebSocketDebug.png" alt="Отладочная информация"></p>

<div>
    Средствами сервера можно отдавать статические фалы по http протоколу
    Как и для WebSocket необходимо зарегистрировать обработчик события полученного запроса
</div>

<div class="highlight highlight-source-cs"><pre><span class="pl-c">// Обрабатываем новый http запрос</span>
HTTP.EventConnect += (<span class="pl-k">object</span> obj, PEventArgs a) =&gt;
{
    <span class="pl-c">// Объект Http</span>
    HTTP Http = obj <span class="pl-k">as</span> HTTP;

    <span class="pl-k">switch</span> (Http.Request.Path)
    {
        <span class="pl-k">case</span> <span class="pl-s"><span class="pl-pds">"</span>/<span class="pl-pds">"</span></span>:
            <span class="pl-c">// отправляем index.html</span>
            Http.File(<span class="pl-s"><span class="pl-pds">"</span>Html/index.html<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>html<span class="pl-pds">"</span></span>);
            <span class="pl-k">break</span>;
        <span class="pl-k">default</span>:
            Http.File(<span class="pl-s"><span class="pl-pds">"</span>Html<span class="pl-pds">"</span></span> + Http.Request.Path, Http.Request.File);
            <span class="pl-k">break</span>;
    }
    <span class="pl-c">// Вывод информации о полученных заголовках</span>
    Console.WriteLine(Http.Request.ToString());
};</pre></div>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/jackyt1988t/WebSocket">Websocket</a> is maintained by <a href="https://github.com/jackyt1988t">jackyt1988t</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
